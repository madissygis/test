<!DOCTYPE html>
<html>
<head>
  <title>PS4 11.50 - History/Frame Lifecycle Test</title>
</head>
<body>
  <h1>Testing History + Iframe Crash</h1>
  <iframe id="testFrame" src="about:blank" style="display:none"></iframe>

  <script>
    const frame = document.getElementById('testFrame');
    
    // Step 1: Write initial content
    frame.contentDocument.open();
    frame.contentDocument.write(`
      <script>
        // Step 2: On load, go back and rewrite
        setTimeout(() => {
          history.back(); // May corrupt frame state
          document.open();
          document.write('<h1>PoC</h1>');
          document.close();
        }, 50);
      <\/script>
    `);
    frame.contentDocument.close();

    // Step 3: Push state to enable back()
    history.pushState({x: 1}, '', '#1');
    history.pushState({x: 2}, '', '#2');

    // Reload to detect crash
    setTimeout(() => {
      console.log("Reloading to check stability...");
      location.href = "?round=1";
    }, 3000);
  </script>
</body>
</html>
